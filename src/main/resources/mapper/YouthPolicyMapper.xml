<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kopo.shallwithme.mapper.IYouthPolicyMapper">

    <!-- 1. 전체 목록 조회 (임베딩용) -->
    <select id="getPolicyList" resultType="YouthPolicyDTO">
        SELECT
            plcy_no,
            plcy_nm,
            plcy_expln_cn,
            biz_prd_bgng_ymd,
            biz_prd_end_ymd,
            aply_url_addr,
            sprvsn_inst_cd_nm
        FROM
            YOUTH_POLICY
        ORDER BY
            biz_prd_bgng_ymd DESC
    </select>

    <!-- 2. 정책 상세 조회 (중복 확인용) -->
    <select id="getPolicyById" parameterType="String" resultType="YouthPolicyDTO">
        SELECT * FROM YOUTH_POLICY
        WHERE plcy_no = #{plcyNo}
    </select>

    <!-- 3. 정책 데이터 삽입 (증분 업데이트용) -->
    <insert id="insertPolicy" parameterType="YouthPolicyDTO">
        INSERT INTO YOUTH_POLICY (
            plcy_no, plcy_nm, plcy_expln_cn, biz_prd_bgng_ymd, biz_prd_end_ymd,
            aply_url_addr, sprvsn_inst_cd_nm, plcy_sprt_cn, plcy_aply_mthd_cn,
            sbmsn_dcmnt_cn, sprt_trgt_min_age, sprt_trgt_max_age, earn_min_amt,
            earn_max_amt, earn_etc_cn, add_aply_qlfc_cnd_cn, ptcp_prp_trgt_cn,
            ref_url_addr1, ref_url_addr2, oper_inst_cd_nm
        ) VALUES (
                     #{plcyNo}, #{plcyNm}, #{plcyExplnCn}, #{bizPrdBgngYmd}, #{bizPrdEndYmd},
                     #{aplyUrlAddr}, #{sprvsnInstCdNm}, #{plcySprtCn}, #{plcyAplyMthdCn},
                     #{sbmsnDcmntCn}, #{sprtTrgtMinAge}, #{sprtTrgtMaxAge}, #{earnMinAmt},
                     #{earnMaxAmt}, #{earnEtcCn}, #{addAplyQlfcCndCn}, #{ptcpPrpTrgtCn},
                     #{refUrlAddr1}, #{refUrlAddr2}, #{operInstCdNm}
                 )
    </insert>

    <!-- 4. (예비용) -->
    <delete id="deleteAllPolicies">
        DELETE FROM YOUTH_POLICY
    </delete>

    <!-- ✅ 5. [추가] 페이징 처리된 목록 조회 (MariaDB/MySQL용 LIMIT OFFSET) -->
    <select id="getPolicyListPaginated" resultType="YouthPolicyDTO">
        SELECT
            plcy_no,
            plcy_nm,
            plcy_expln_cn,
            biz_prd_bgng_ymd,
            biz_prd_end_ymd,
            aply_url_addr,
            sprvsn_inst_cd_nm
        FROM
            YOUTH_POLICY
        ORDER BY
            biz_prd_bgng_ymd DESC
            LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ✅ 6. [추가] 전체 정책 개수 조회 -->
    <select id="getTotalPolicyCount" resultType="int">
        SELECT COUNT(*)
        FROM YOUTH_POLICY
    </select>

</mapper>
