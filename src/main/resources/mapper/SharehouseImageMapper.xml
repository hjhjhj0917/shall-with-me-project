<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kopo.shallwithme.mapper.ISharehouseImageMapper">

    <resultMap id="SharehouseImageResultMap" type="kopo.shallwithme.dto.SharehouseImageDTO">
        <id     property="imgId"     column="img_id"/>
        <result property="houseId"   column="house_id"/>
        <result property="url"       column="url"/>
        <result property="isMain"    column="is_main"/>
        <result property="sortOrder" column="sort_order"/>
        <result property="regDt"     column="reg_dt"/>
    </resultMap>

    <insert id="insertImage" parameterType="kopo.shallwithme.dto.SharehouseImageDTO">
        INSERT INTO SHARE_HOUSE_IMAGE
            (house_id, url, is_main, sort_order, reg_dt)
        VALUES
            (#{houseId}, #{url}, #{isMain}, #{sortOrder}, NOW())
    </insert>

    <insert id="insertImages" parameterType="list">
        INSERT INTO SHARE_HOUSE_IMAGE
        (house_id, url, is_main, sort_order, reg_dt)
        VALUES
        <foreach collection="list" item="p" separator=",">
            (#{p.houseId}, #{p.url}, #{p.isMain}, #{p.sortOrder}, NOW())
        </foreach>
    </insert>

    <select id="selectByHouseId"
            parameterType="kopo.shallwithme.dto.SharehouseImageDTO"
            resultMap="SharehouseImageResultMap">
        SELECT img_id, house_id, url, is_main, sort_order, reg_dt
        FROM SHARE_HOUSE_IMAGE
        WHERE house_id = #{houseId}
        ORDER BY is_main DESC, sort_order ASC, img_id ASC
    </select>

    <select id="selectMainByHouseId"
            parameterType="kopo.shallwithme.dto.SharehouseImageDTO"
            resultMap="SharehouseImageResultMap">
        SELECT img_id, house_id, url, is_main, sort_order, reg_dt
        FROM SHARE_HOUSE_IMAGE
        WHERE house_id = #{houseId}
          AND is_main = 1
        ORDER BY img_id ASC
            LIMIT 1
    </select>

    <delete id="deleteById" parameterType="kopo.shallwithme.dto.SharehouseImageDTO">
        DELETE FROM SHARE_HOUSE_IMAGE
        WHERE img_id = #{imgId}
    </delete>

    <delete id="deleteByHouseId" parameterType="kopo.shallwithme.dto.SharehouseImageDTO">
        DELETE FROM SHARE_HOUSE_IMAGE
        WHERE house_id = #{houseId}
    </delete>

</mapper>
